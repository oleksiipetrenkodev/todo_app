<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Todo Minimal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 720px;
        margin: 24px auto;
        padding: 0 12px;
      }
      form,
      section {
        margin-bottom: 20px;
      }
      input,
      button {
        padding: 8px;
      }
      ul {
        padding-left: 16px;
      }
      .card {
        border: 1px solid #ddd;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 8px;
      }
    </style>
  </head>
  <body>
    <h1>Todo Minimal</h1>

    <section id="auth">
      <h2>Auth</h2>
      <form id="loginForm">
        <input name="email" type="email" placeholder="email" required />
        <input name="password" type="password" placeholder="password" required />
        <button type="submit">Login</button>
        <button type="button" id="logoutBtn">Logout</button>
      </form>
      <div id="authStatus"></div>
    </section>

    <section id="createTask">
      <h2>Create Task</h2>
      <form id="taskForm">
        <input name="title" placeholder="task title" required />
        <button type="submit">Add</button>
      </form>
    </section>

    <section id="tasks">
      <h2>Tasks</h2>
      <ul id="taskList"></ul>
    </section>

    <script>
      const API = 'http://localhost:3000/api';
      const getToken = () => localStorage.getItem('token');
      const setToken = (t) => localStorage.setItem('token', t);
      const clearToken = () => localStorage.removeItem('token');

      const authStatus = document.getElementById('authStatus');
      const loginForm = document.getElementById('loginForm');
      const logoutBtn = document.getElementById('logoutBtn');
      const taskForm = document.getElementById('taskForm');
      const taskList = document.getElementById('taskList');

      function setAuthStatus() {
        authStatus.textContent = getToken() ? 'Logged in' : 'Logged out';
      }

      taskForm.addEventListener('submit', async function (e) {
        e.preventDefault();
        const form = new FormData(taskForm);
        try {
          await api('/api/tasks', {
            method: 'POST',
            body: JSON.stringify({
              title: form.get('title'),
            }),
          });
          taskForm.reset();
          await loadTasks();
        } catch (e) {
          console.log(e);
        }
      });

      function loadTasks() {
        console.log('loadTasks');
      }

      setAuthStatus();
      if (getToken()) loadTasks();

      // async function api(path, options = {}) {
      //   const token = getToken();
      //   const headers = { "Content-Type": "application/json", ...(options.headers || {}) };
      //   if (token) headers["Authorization"] = `Bearer ${token}`;
      //   const res = await fetch(`${API}${path}`, { ...options, headers });
      //   if (!res.ok) {
      //     const err = await res.json().catch(() => ({}));
      //     throw new Error(err.error || `HTTP ${res.status}`);
      //   }
      //   return res.json().catch(() => ({}));
      // }

      // loginForm.addEventListener("submit", async (e) => {
      //   e.preventDefault();
      //   const form = new FormData(loginForm);
      //   try {
      //     const data = await api("/auth/login", {
      //       method: "POST",
      //       body: JSON.stringify({ email: form.get("email"), password: form.get("password") }),
      //     });
      //     setToken(data.token);
      //     setAuthStatus();
      //     await loadTasks();
      //   } catch (e) {
      //     alert(e.message);
      //   }
      // });

      // logoutBtn.addEventListener("click", () => {
      //   clearToken();
      //   setAuthStatus();
      //   taskList.innerHTML = "";
      // });

      // taskForm.addEventListener("submit", async (e) => {
      //   e.preventDefault();
      //   const form = new FormData(taskForm);
      //   try {
      //     await api("/v1/tasks", { method: "POST", body: JSON.stringify({ title: form.get("title") }) });
      //     taskForm.reset();
      //     await loadTasks();
      //   } catch (e) {
      //     alert(e.message);
      //   }
      // });

      // async function loadTasks() {
      //   try {
      //     const items = await api("/v1/tasks");
      //     taskList.innerHTML = "";
      //     items.forEach((t) => {
      //       const li = document.createElement("li");
      //       li.className = "card";
      //       li.textContent = `${t.title} ${t.completed ? "âœ“" : ""}`;
      //       taskList.appendChild(li);
      //     });
      //   } catch (e) {
      //     taskList.innerHTML = "<li>Failed to load</li>";
      //   }
      // }

      // setAuthStatus();
      // if (getToken()) loadTasks();
    </script>
  </body>
</html>
